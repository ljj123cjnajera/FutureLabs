<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Producto - FutureLabs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/notifications.css">
    <link rel="stylesheet" href="css/reviews.css">
    <style>
.product-detail-page {
    min-height: 100vh;
    padding-top: 100px;
    padding-bottom: 60px;
}

.product-detail-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-bottom: 60px;
}

.product-images {
    position: sticky;
    top: 120px;
}

.main-image {
    width: 100%;
    height: 500px;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 20px;
    background: #f5f5f5;
}

.main-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.product-info-detail {
    background: white;
    border-radius: 12px;
    padding: 40px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.product-brand-detail {
    font-size: 14px;
    color: #3498db;
    text-transform: uppercase;
    font-weight: 600;
    margin-bottom: 10px;
}

.product-title-detail {
    font-size: 32px;
    font-weight: 700;
    color: #333;
    margin-bottom: 20px;
}

.product-rating-detail {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
}

.stars-detail {
    color: #ffc107;
    font-size: 20px;
}

.rating-text-detail {
    font-size: 16px;
    font-weight: 600;
    color: #333;
}

.rating-count-detail {
    font-size: 14px;
    color: #999;
}

.product-price-detail {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
}

.current-price-detail {
    font-size: 36px;
    font-weight: 700;
    color: #e74c3c;
}

.old-price-detail {
    font-size: 24px;
    color: #999;
    text-decoration: line-through;
}

.product-description-detail {
    font-size: 16px;
    line-height: 1.6;
    color: #666;
    margin-bottom: 30px;
}

.product-specs-detail {
    margin-bottom: 30px;
}

.spec-item {
    display: flex;
    padding: 12px 0;
    border-bottom: 1px solid #eee;
}

.spec-label {
    font-weight: 600;
    color: #333;
    min-width: 150px;
}

.spec-value {
    color: #666;
}

.product-actions-detail {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
}

.btn-buy-now {
    flex: 1;
    background: #e74c3c;
    color: white;
    border: none;
    padding: 16px;
    border-radius: 8px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-buy-now:hover {
    background: #c0392b;
    transform: translateY(-2px);
}

.btn-add-cart-detail {
    flex: 1;
    background: #3498db;
    color: white;
    border: none;
    padding: 16px;
    border-radius: 8px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-add-cart-detail:hover {
    background: #2980b9;
    transform: translateY(-2px);
}

.btn-favorite-detail {
    background: #ecf0f1;
    color: #e74c3c;
    border: none;
    padding: 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-favorite-detail:hover {
    background: #e74c3c;
    color: white;
}

.product-stock-detail {
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-weight: 600;
}

.in-stock-detail {
    background: #d4edda;
    color: #155724;
}

.out-of-stock-detail {
    background: #f8d7da;
    color: #721c24;
}

.loading-detail {
    text-align: center;
    padding: 100px;
}

@media (max-width: 768px) {
    .product-detail-container {
        grid-template-columns: 1fr;
    }
    
    .product-images {
        position: static;
    }
    
    .main-image {
        height: 300px;
    }
}
    </style>
</head>
<body>
    <!-- Header Dinámico -->
    <header id="mainHeader"></header>

    <!-- Product Detail Page -->
    <div class="product-detail-page">
<div class="container">
    <div id="productDetailContainer">
        <div class="loading-detail">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p>Cargando producto...</p>
        </div>
    </div>
</div>

<!-- Reviews Section -->
<div class="container">
    <div id="reviewsContainer"></div>
</div>
    </div>

    <!-- Scripts -->
    <!-- Scripts del Sistema Integrado -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/skeleton.js"></script>
    <script src="js/modals.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/reviews.js"></script>
    <script src="js/related-products.js"></script>
    <script src="js/components.js"></script>
    
    <script>
// Inicializar header dinámico y cargar producto
document.addEventListener('DOMContentLoaded', async function() {
    // Inicializar header
    const headerContainer = document.getElementById('mainHeader');
    if (headerContainer && window.Components) {
        headerContainer.innerHTML = window.Components.getHeader(false, false);
        window.Components.initHeader();
    }
    
    // Obtener ID del producto de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    // Cargar reseñas
    async function loadReviews() {
        const container = document.getElementById('reviewsContainer');
        if (!container) return;
        
        try {
            const { reviews, stats } = await window.reviewsManager.loadReviews(productId);
            window.reviewsManager.renderReviews(container, productId);
        } catch (error) {
            console.error('Error loading reviews:', error);
        }
    }

    // Cargar producto
    async function loadProduct() {
        const container = document.getElementById('productDetailContainer');
        
        if (!productId) {
            container.innerHTML = `
            <div style="text-align: center; padding: 100px;">
                <i class="fas fa-exclamation-triangle fa-3x" style="color: #e74c3c; margin-bottom: 20px;"></i>
                <h2>Producto no encontrado</h2>
                <p>El producto que buscas no existe</p>
            </div>
        `;
        return;
    }

    try {
        const response = await window.api.getProduct(productId);
        
        if (response.success && response.data.product) {
            const product = response.data.product;
            
            container.innerHTML = `
                <div class="product-detail-container">
                    <div class="product-images">
                        <div class="main-image">
                            <img src="${product.image_url || 'assets/images/products/placeholder.jpg'}" alt="${product.name}">
                        </div>
                    </div>
                    
                    <div class="product-info-detail">
                        <p class="product-brand-detail">${product.brand}</p>
                        <h1 class="product-title-detail">${product.name}</h1>
                        
                        <div class="product-rating-detail">
                            <span class="stars-detail">★★★★★</span>
                            <span class="rating-text-detail">${product.rating || 0}</span>
                            <span class="rating-count-detail">(${product.review_count || 0} reseñas)</span>
                        </div>
                        
                        <div class="product-price-detail">
                            <span class="current-price-detail">S/ ${product.price}</span>
                            ${product.discount_price < product.price ? `<span class="old-price-detail">S/ ${product.discount_price}</span>` : ''}
                        </div>
                        
                        <div class="product-description-detail">
                            ${product.description || 'Sin descripción disponible'}
                        </div>
                        
                        ${product.specifications ? `
                        <div class="product-specs-detail">
                            <h3 style="margin-bottom: 15px;">Especificaciones</h3>
                            ${Object.entries(product.specifications).map(([key, value]) => `
                                <div class="spec-item">
                                    <span class="spec-label">${key}:</span>
                                    <span class="spec-value">${value}</span>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        <div class="product-stock-detail ${product.stock_quantity > 0 ? 'in-stock-detail' : 'out-of-stock-detail'}">
                            <i class="fas fa-${product.stock_quantity > 0 ? 'check-circle' : 'times-circle'}"></i>
                            ${product.stock_quantity > 0 ? `En stock (${product.stock_quantity} disponibles)` : 'Agotado'}
                        </div>
                        
                        <div class="product-actions-detail d-flex gap-md">
                            <button class="btn btn-primary btn-lg" onclick="addToCart()" ${product.stock_quantity === 0 ? 'disabled' : ''}>
                                <i class="fas fa-shopping-cart"></i> Agregar al Carrito
                            </button>
                            <button class="btn btn-ghost btn-lg" onclick="addToFavorites()">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        
                        <button class="btn btn-secondary btn-lg btn-full" onclick="buyNow()" ${product.stock_quantity === 0 ? 'disabled' : ''}>
                            <i class="fas fa-bolt"></i> Comprar Ahora
                        </button>
                    </div>
                </div>
            `;
            
            // Cargar reseñas
            await loadReviews();
        } else {
            container.innerHTML = `
                <div style="text-align: center; padding: 100px;">
                    <i class="fas fa-exclamation-triangle fa-3x" style="color: #e74c3c; margin-bottom: 20px;"></i>
                    <h2>Producto no encontrado</h2>
                    <p>El producto que buscas no existe</p>
                </div>
            `;
        }
    } catch (error) {
        container.innerHTML = `
            <div style="text-align: center; padding: 100px;">
                <i class="fas fa-exclamation-triangle fa-3x" style="color: #e74c3c; margin-bottom: 20px;"></i>
                <h2>Error al cargar el producto</h2>
                <p>${error.message}</p>
            </div>
        `;
    }
}

// Agregar al carrito
async function addToCart() {
    await window.cartManager.add(productId, 1);
}

// Agregar a favoritos
function addToFavorites() {
    window.notifications.info('Funcionalidad de favoritos próximamente');
}

// Comprar ahora
async function buyNow() {
    await window.cartManager.add(productId, 1);
    window.notifications.success('Redirigiendo al checkout...');
    setTimeout(() => {
        window.location.href = 'checkout.html';
    }, 1000);
}

    // Actualizar contador de carrito
    document.addEventListener('cartUpdated', (e) => {
        const cartCount = document.querySelector('.cart-count');
        if (cartCount) {
            cartCount.textContent = e.detail.count;
        }
    });

    // Cargar producto al iniciar
    await loadProduct();
});
    </script>
</body>
</html>

